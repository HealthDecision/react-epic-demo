(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{357:function(e,t,n){e.exports=n(778)},394:function(e,t,n){},399:function(e,t,n){},404:function(e,t){},420:function(e,t){},422:function(e,t){},454:function(e,t){},455:function(e,t){},523:function(e,t){},778:function(e,t,n){"use strict";n.r(t);n(358);var a=n(0),r=n.n(a),i=n(89),o=n.n(i),l=(n(394),n(396),n(37)),s=n(38),c=n(47),u=n(45),d=n(48),h=(n(399),n(793)),m=n(786),p=n(794),f=n(791),b=n(783),E=n(790),y=n(784),g=n(787),O=n(332),D=n(65),T=n(12),j=n(91),R=n.n(j),v="FHIR/GET_DATA",k="FHIR/GET_DATA_FAILED",w="FHIR/GET_DATA_SUCCEEDED",I="FHIR/LOAD_SAMPLE_DATA",A="TOGGLE_EXAMPLE_VISIBILITY",U="ADD_EXAMPLE_DATA",F={byResource:{patient:{title:"Patient",status:"",error:null,icon:"male"},conditions:{title:"Conditions",status:"",error:null,icon:"numbered list"},familyMemberHistories:{title:"Family Member History",status:"",error:null,icon:"numbered list"}},sampleDataLoaded:!1,allResourcesLoaded:!1,examples:{}};var H=function(e){return{type:k,resourceType:e}},C=function(e,t){return{type:w,resourceType:e,response:t}},S=function(e){return{type:A,exampleKey:e}},M=function(e,t,n,a,r){return{type:U,key:e,need:t,phi:a,deidentified:r,title:n}},x=function(e){return function(t,n){t({type:v,resourceType:e});var a=n(),r=a.fhirAuth.patientId,i=a.fhirAuth.client;if("patient"===e)i.read({type:"Patient",id:r}).then(function(n){var a=new Date,r=n.data.birthDate,i=new Date(r),o=a.getFullYear()-i.getFullYear(),l=a.getMonth()-i.getMonth();(l<0||0===l&&a.getDate()<i.getDate())&&o--,o>=90?o="Greater than 90":o+=" year old",t(M("gender","Gender","Gender",n.data.gender,n.data.gender)),t(M("dob","Age","Date of Birth",n.data.birthDate,o)),t(M("mrn","Unique key","MRN",n.data.identifier.find(function(e){return"urn:oid:1.2.840.114350.1.13.0.1.7.5.737384.0"===e.system}).value,'May be possible with "Expert Determination" method')),t(M("hdl","HDL within the last six months","HDL Observation","38 mg/dL measured on "+R()().subtract(2,"months").format("YYYY-MM-DD"),"38 mg/dL")),t(M("radiation","Past chest radiation?","Radiation","Chest radiation on "+R()().subtract(9,"years").format("YYYY-MM-DD"),"No")),t(C(e,n))}).catch(function(n){console.log("Error!"),console.log(n),t(H(e))});else{if("conditions"!==e&&"observations"!==e&&"familyMemberHistories"!==e)return alert("Unexpected resource type requested '"+e+"'."),t(H(e));i.search({type:{conditions:"Condition",observations:"Observation",familyMemberHistories:"FamilyMemberHistory"}[e],patient:r}).then(function(n){if("conditions"===e){var a=n.data.entry.find(function(e){return"undefined"!==typeof e.resource.code.coding.find(function(e){return"http://snomed.info/sct"===e.system&&"46635009"===e.code})});null!==a?(t(M("diabetes","Is diabetic?","Diabetes Condition",a.resource.code.text+" with onset date "+a.resource.onsetDateTime,"Has diabetes, ignore the onset date")),t(C(e,n))):t(C(e,n))}else t(C(e,n))}).catch(function(n){return console.log("Error!"),console.log(n),t(H(e))})}}},L=n(46),_=n(785),Y=n(209),z=n.n(Y),P=n(87),G=n.n(P),N=n(205),B=n.n(N),K=null,V=null,q=null,J=function(){function e(){if(Object(l.a)(this,e),q)return q;this.scopes=["launch","openid profile","patient/*.read"],this.redirectUri=V,this.clientId=K,q=this}return Object(s.a)(e,[{key:"setProps",value:function(e,t,n,a){this.iss=e,this.launch=t,this.authorizeUrl=n,this.tokenUrl=a,this.state=B()(),this.oauth=new z.a({clientId:this.clientId,authorizationUri:n,accessTokenUri:a,redirectUri:this.redirectUri,state:this.state,scopes:this.scopes});var r=JSON.stringify({iss:e,authorizeUrl:n,tokenUrl:a});window.sessionStorage.setItem(this.state,r)}},{key:"getTokenRedirectUri",value:function(){return this.oauth.code.getUri({query:{aud:this.iss,launch:this.launch}})}},{key:"getAccessToken",value:function(e){var t=G.a.parse(e),n=window.sessionStorage.getItem(t.state);return null===n?null:(n=JSON.parse(n),window.sessionStorage.removeItem(t.state),this.iss=n.iss,this.authorizeUrl=n.authorizeUrl,this.tokenUrl=n.tokenUrl,this.oauth=new z.a({clientId:this.clientId,authorizationUri:this.authorizeUrl,accessTokenUri:this.tokenUrl,redirectUri:this.redirectUri,scopes:this.scopes}),this.oauth.code.getToken(e))}}]),e}(),X=n(335),W=n.n(X),Z=n(336),$=n.n(Z),Q="FHIR/SMART_INITIALIZE",ee="FHIR/GET_METADATA",te="FHIR/GET_METADATA_FAILED",ne="FHIR/GET_METADATA_SUCCEEDED",ae="FHIR/GET_ACCESS_TOKEN",re="FHIR/ACCESS_TOKEN_RECEIVED",ie="FHIR/ERROR",oe="FHIR/SET_ISSUER",le={credentials:{clientId:K,redirectURI:V},isFetching:!1,iss:null,launch:null,authorizeUrl:null,tokenUrl:null,userFriendlyStatus:"Waiting...",redirectToTokenUri:!1,error:null,accessToken:null,patientId:null,client:null};var se=function(e){return function(t,n){t({type:ee,iss:e}),$.a.get("".concat(e,"/metadata")).then(function(e){var n=e.data,a=n.rest[0].security.extension.find(function(e){return"http://fhir-registry.smarthealthit.org/StructureDefinition/oauth-uris"===e.url}).extension,r=a.find(function(e){return"authorize"===e.url}),i=a.find(function(e){return"token"===e.url});n.software&&n.software.name&&"Fnd 2018"===n.software.name?window.sessionStorage.setItem("ehr","Epic"):window.sessionStorage.setItem("ehr","Unknown"),t(ce(r.valueUri,i.valueUri))}).catch(function(e){t(ue(e.toString()))})}},ce=function(e,t){return{type:ne,authorizeUrl:e,tokenUrl:t}},ue=function(e){return{type:te,error:e}},de=function(e){return function(t,n){t({type:ae,uri:e});var a=new J,r=a.getAccessToken(e);null!==r?r.then(function(e){var n;t((n=a.iss,{type:oe,iss:n})),t(he(e)),t(x("patient")),setTimeout(function(){t(x("conditions"))},100),setTimeout(function(){t(x("familyMemberHistories"))},200)}):t(me("FHIR_AT_1","Could not request token, missing FHIR session."))}},he=function(e){return{type:re,tokenResponsePayload:e}},me=function(e,t){return{type:ie,code:e,description:t}},pe=n(789),fe=n(781),be=n(788),Ee=n(782),ye=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement(pe.a.Group,{size:"mini",fluid:!0},r.a.createElement(pe.a,{completed:null!==this.props.fhirAuth.accessToken},r.a.createElement(O.a,{name:"address card"}),r.a.createElement(pe.a.Content,null,r.a.createElement(pe.a.Title,null,"Get Access Token"),r.a.createElement(pe.a.Description,null,null===this.props.fhirAuth.accessToken?"Retrieving...":"Retrieved"))),Object.keys(this.props.fhirData.byResource).map(function(t){var n=e.props.fhirData.byResource[t];return r.a.createElement(pe.a,{key:t,completed:"loaded"===n.status},r.a.createElement(O.a,{name:n.icon}),r.a.createElement(pe.a.Content,null,r.a.createElement(pe.a.Title,null,n.title),r.a.createElement(pe.a.Description,null,"loading"===n.status&&r.a.createElement(r.a.Fragment,null,r.a.createElement(fe.a,{size:"mini",active:!0,inline:!0}),"\xa0Retrieving..."),"loaded"===n.status&&"Retrieved","failed"===n.status&&"Failed")))})),this.props.fhirData.allResourcesLoaded&&r.a.createElement(r.a.Fragment,null,r.a.createElement("h2",null,"Examples"),r.a.createElement(be.a,{celled:!0,definition:!0,size:"small"},r.a.createElement(be.a.Header,null,r.a.createElement(be.a.Row,null,r.a.createElement(be.a.HeaderCell,null),r.a.createElement(be.a.HeaderCell,{width:"four"},"Application Need"),r.a.createElement(be.a.HeaderCell,null,"FHIR Data Point"),r.a.createElement(be.a.HeaderCell,null,"PHI"),r.a.createElement(be.a.HeaderCell,{width:"four"},"Possible De-identification"))),r.a.createElement(be.a.Body,null,Object.keys(this.props.fhirData.examples).map(function(t){var n=e.props.fhirData.examples[t];return r.a.createElement(be.a.Row,{key:t},r.a.createElement(be.a.Cell,{collapsing:!0},r.a.createElement(Ee.a,{toggle:!0,size:"mini",onClick:function(){return e.props.toggleExampleVisibility(t)}})),r.a.createElement(be.a.Cell,null,n.need),r.a.createElement(be.a.Cell,null,n.title),r.a.createElement(be.a.Cell,null,n.phi),r.a.createElement(be.a.Cell,null,n.hidden?r.a.createElement(r.a.Fragment,null,"******"):r.a.createElement(r.a.Fragment,null,n.deidentified,"radiation"===t&&r.a.createElement(r.a.Fragment,null,r.a.createElement("sup",{style:{float:"right"}},"* No Observations within the last 5 years")),"dob"===t&&r.a.createElement(r.a.Fragment,null,r.a.createElement("sup",{style:{float:"right"}},"* for >=90 assume 90")))))})))))}}]),t}(a.Component),ge=Object(L.b)(function(e,t){return{fhirAuth:e.fhirAuth,fhirData:e.fhirData}},function(e){return{getAccessToken:function(t){return e(de(t))},toggleExampleVisibility:function(t){return e(S(t))}}})(ye),Oe=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){this.props.getAccessToken(window.location.href)}},{key:"render",value:function(){var e=this.props.fhirAuth;return null!==e.error?r.a.createElement(b.a,{style:{paddingTop:"10px"}},r.a.createElement(E.a,{negative:!0,icon:!0},r.a.createElement(O.a,{name:"warning sign"}),r.a.createElement(E.a.Content,null,r.a.createElement(E.a.Header,null,"Error"),r.a.createElement("div",null,e.error.description),r.a.createElement(y.a,null),r.a.createElement(g.a,{basic:!0,as:_.a,size:"small",to:"/"},"< Home")))):r.a.createElement(ge,null)}}]),t}(a.Component),De=Object(L.b)(function(e,t){return{fhirAuth:e.fhirAuth,fhirData:e.fhirData}},function(e){return{getAccessToken:function(t){return e(de(t))},toggleExampleVisibility:function(t){return e(S(t))}}})(Oe),Te=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){var e=G.a.parse(window.location.search.slice(1));return"undefined"===typeof e.iss?(alert("Issuer not specified. Aborting."),void(window.location="/")):"undefined"===typeof e.launch?(alert("Launch code not specified. Aborting."),void(window.location="/")):void this.props.initializeSmart(e.iss,e.launch)}},{key:"render",value:function(){var e=this.props.fhirAuth;if(!0===e.redirectToTokenUri){var t=new J;t.setProps(e.iss,e.launch,e.authorizeUrl,e.tokenUrl),window.location=t.getTokenRedirectUri()}return null!==e.error?r.a.createElement("div",null,"Error: ",e.error):r.a.createElement(fe.a,{active:!0,inline:"centered"},this.props.fhirAuth.userFriendlyStatus)}}]),t}(a.Component),je=Object(L.b)(function(e,t){return{fhirAuth:e.fhirAuth}},function(e){return{initializeSmart:function(t,n){return e(function(e,t){return function(n){n({type:Q,iss:e,launch:t}),n(se(e))}}(t,n))}}})(Te),Re=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("h1",null,"404 - Page not found"),r.a.createElement("pre",null,window.location.href),r.a.createElement(g.a,{as:_.a,to:"/"},r.a.createElement(O.a,{name:"home"})," Home"))}}]),t}(a.Component),ve=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this,t=this.props.credentials;return r.a.createElement(r.a.Fragment,null,r.a.createElement(f.a,{inverted:!0,color:"red",attached:!0},r.a.createElement(f.a.Item,{header:!0},"HealthDecision \u2013 Browser-Based FHIR Integration")),r.a.createElement(b.a,{style:{paddingTop:"10px"}},r.a.createElement(h.a,null,r.a.createElement(m.a,{path:"/",exact:!0,render:function(){return!0===e.props.sampleDataLoaded?r.a.createElement(r.a.Fragment,null,r.a.createElement("h3",null,"Sample Data"),r.a.createElement(ge,null)):r.a.createElement(r.a.Fragment,null,r.a.createElement("h3",null,"Root URL"),r.a.createElement("div",null,(null===t.clientId||""===t.clientId||null===t.redirectURI||""===t.redirectURI)&&r.a.createElement(E.a,{error:!0},r.a.createElement(E.a.Header,null,"Configuration Error"),r.a.createElement("ul",null,(null===t.clientId||""===t.clientId)&&r.a.createElement("li",null,"clientID is missing."),(null===t.redirectURI||""===t.redirectURI)&&r.a.createElement("li",null,"redirectURI is missing.")),r.a.createElement("p",null,"Please set in credentials.js.")),"Note that there is nothing at the root URL. This app must be called from"," ",r.a.createElement("a",{href:"https://apporchard.epic.com",target:"_blank",rel:"noopener noreferrer"},"Epic App Orchard Simulator")," ","(or Epic Hyperspace) using the SMART launch workflow.",r.a.createElement("br",null),r.a.createElement(y.a,null),r.a.createElement(g.a,{icon:!0,onClick:e.props.loadSampleData,labelPosition:"left"},r.a.createElement(O.a,{name:"microchip"})," Load Sample Data")))}}),r.a.createElement(m.a,{path:"/fhir/epic/launch",exact:!0,component:je}),r.a.createElement(m.a,{path:"/fhir/epic/redirect",exact:!0,component:De}),r.a.createElement(m.a,{path:"*",component:Re}))))}}]),t}(a.Component),ke=Object(p.a)(Object(L.b)(function(e){return{sampleDataLoaded:e.fhirData.sampleDataLoaded,credentials:e.fhirAuth.credentials}},function(e){return{loadSampleData:function(){return e(function(e){e({type:I})})}}})(ve)),we=n(792),Ie=n(64),Ae=n(347),Ue=Object(Ie.c)({fhirAuth:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:le,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case I:return Object(T.a)({},e,{accessToken:{dummy:!0}});case Q:return Object(T.a)({},e,{iss:t.iss,launch:t.launch,userFriendlyStatus:"Initializing..."});case oe:return Object(T.a)({},e,{iss:t.iss});case ie:return Object(T.a)({},e,{error:{code:t.code,description:t.description}});case ee:return Object(T.a)({},e,{isFetching:!0,accessToken:null,userFriendlyStatus:"Fetching metadata..."});case ne:return Object(T.a)({},e,{isFetching:!1,authorizeUrl:t.authorizeUrl,tokenUrl:t.tokenUrl,redirectToTokenUri:!0,userFriendlyStatus:"Redirecting...",accessToken:null,error:null});case te:return Object(T.a)({},e,{isFetching:!1,error:t.error});case ae:return e;case re:var n=t.tokenResponsePayload,a={baseUrl:e.iss,auth:{bearer:n.accessToken}},r=W()(a);return Object(T.a)({},e,{isFetching:!1,userFriendlyStatus:"Access token received...",error:null,patientId:n.data.patient,client:r,accessToken:{expires:n.expires,data:n.data}});case v:return Object(T.a)({},e,{userFriendlyStatus:"Getting data..."});default:return e}},fhirData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case I:return Object(T.a)({},e,{sampleDataLoaded:!0,allResourcesLoaded:!0,byResource:{patient:Object(T.a)({},e.byResource.patient,{status:"loaded",error:null}),conditions:Object(T.a)({},e.byResource.conditions,{status:"loaded",error:null}),familyMemberHistories:Object(T.a)({},e.byResource.familyMemberHistories,{status:"loaded",error:null})},examples:{gender:{need:"Gender",title:"Gender",phi:"male",deidentified:"male",hidden:!0},dob:{need:"Age",title:"Date of Birth",phi:R()().subtract(48,"years").format("YYYY-MM-DD"),deidentified:"48 year old",hidden:!0},mrn:{need:"Unique key",title:"Medical Record Number",phi:"E83833",deidentified:'May be possible with "Expert Determination" method',hidden:!0},hdl:{need:"HDL within the last six months",title:"HDL Observation",phi:"38 mg/dL measured on "+R()().subtract(2,"months").format("YYYY-MM-DD"),deidentified:"38 mg/dL",hidden:!0},radiation:{need:"Past chest radiation?",title:"Radiation",phi:"Chest radiation on "+R()().subtract(9,"years").format("YYYY-MM-DD"),deidentified:"No",hidden:!0},diabetes:{need:"Is diabetic?",title:"Diabetes Condition",phi:"Type 1 diabetes mellitus (CMS/HCC) with onset date 2010-08-17",deidentified:"Has diabetes, ignore the onset date",hidden:!0}}});case v:return Object(T.a)({},e,{allResourcesLoaded:!1,byResource:Object(T.a)({},e.byResource,Object(D.a)({},t.resourceType,Object(T.a)({},e.byResource[t.resourceType],{error:null,status:"loading"})))});case k:return Object(T.a)({},e,{byResource:Object(T.a)({},e.byResource,Object(D.a)({},t.resourceType,Object(T.a)({},e.byResource[t.resourceType],{error:t.error,status:"failed"})))});case w:var n=!Object.keys(e.byResource).some(function(n){return n!==t.resourceType&&"loaded"!==e.byResource[n].status});return Object(T.a)({},e,{allResourcesLoaded:n,byResource:Object(T.a)({},e.byResource,Object(D.a)({},t.resourceType,Object(T.a)({},e.byResource[t.resourceType],{error:null,status:"loaded"})))});case U:var a={need:t.need,title:t.title,phi:t.phi,deidentified:t.deidentified,hidden:!0};return Object(T.a)({},e,{examples:Object(T.a)({},e.examples,Object(D.a)({},t.key,a))});case A:return Object(T.a)({},e,{examples:Object(T.a)({},e.examples,Object(D.a)({},t.exampleKey,Object(T.a)({},e.examples[t.exampleKey],{hidden:!e.examples[t.exampleKey].hidden})))});default:return e}}}),Fe=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||Ie.d;Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var He=Object(Ie.e)(Ue,Fe(Object(Ie.a)(Ae.a)));o.a.render(r.a.createElement(L.a,{store:He},r.a.createElement(we.a,{basename:"/react-epic-demo"},r.a.createElement(ke,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[357,2,1]]]);
//# sourceMappingURL=main.a6aa2d48.chunk.js.map